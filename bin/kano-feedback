#!/usr/bin/env python

# kano-feedback
#
# Copyright (C) 2014 Kano Computing Ltd.
# License: http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
#

import os
import sys
from gi.repository import Gtk
from kano_world.functions import is_registered
from kano.utils import run_cmd
from kano.network import is_internet

if __name__ == '__main__' and __package__ is None:
    dir_path = os.path.abspath(os.path.join(os.path.dirname(__file__), '..'))
    if dir_path != '/usr':
        sys.path.insert(0, dir_path)

from kano_feedback.MainWindow import MainWindow


def main():
    win = MainWindow()

    win.show_all()
    Gtk.main()

    return 0

if __name__ == '__main__':

    # Check internet status
    if not is_internet():
        run_cmd('sudo /usr/bin/kano-settings 4')
        if not is_internet():
            sys.exit(1)

    # Check if user is registered
    if not is_registered():
        run_cmd('/usr/bin/kano-login')
        if not is_registered():
            sys.exit(2)

    # User is registered, launch app
    sys.exit(main())
